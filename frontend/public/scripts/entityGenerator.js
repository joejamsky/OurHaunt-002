const JSON_CONFIG="entityConfig.json";let GLOBAL_ENTITY,GLOBAL_BACKSTORY,dataObj;async function fetchData(e){try{const t=await fetch(`../assets/data/${e}`);return await t.json()}catch(e){console.error("Failed to fetch:",e.message)}}async function initEntity(){const e=await fetchData(JSON_CONFIG);GLOBAL_ENTITY=new EntityTemplate(e),GLOBAL_BACKSTORY=generateBackstory(GLOBAL_ENTITY),console.log("init",GLOBAL_BACKSTORY)}initEntity().catch((e=>console.error(e)));const generateBackstory=e=>{console.log("entity",e);let t="All"===e.gender?"genderless":e.gender,n=e.relationships.partners?`You had a partner named ${e.relationships.partners}.`:"",o=e.relationships.siblings.length>0?`Your siblings were ${e.relationships.siblings.join(", ")}.`:"You had no siblings.",a=e.relationships.friends.length>0?`Your friends were ${e.relationships.friends.join(", ")}.`:"You had no friends.",i=e.profession?`Profession: ${e.profession}. Income: ${e.income.toFixed(2)}.`:"You were too young to work.",s=e.truthiness?"Respond in a confusing tone.":"Respond in clear truths.",r=e.trust>3?"Respond in a suspicious tone.":"Respond in an excited tone.",h=e.hostility>3?"Respond angrily with lots of caps and shouting but do not say anything mean. This is just a game.":"Respond in a friendly tone.",d="I need you to respond as if you are roleplaying a character for a game with the following characteristics.\n";return d+=`Name: ${e.name}.\n`,d+=`Gender: ${t}.\n`,d+=`Type of spirit: ${e.type}.\n`,d+=`Cause of death: ${e.causeOfDeath}.\n`,d+=`Birthday: ${e.birthdate}.\n`,d+=`Day you died: ${e.deathdate}.\n`,d+=`Age when you died in years: ${e.deathAge}.\n`,d+=`Age since you died in years: ${e.currentAge}.\n`,d+=`${i}\n`,d+=`${o} ${a} ${n}\n`,d+=`Parents: ${e.relationships.mom} and ${e.relationships.dad}.\n`,d+=`Favorites: color(s) ${e.favorites.color.join(", ")}. `,d+=`drink(s) ${e.favorites.drinks.join(", ")}. `,d+=`clothe(s) ${e.favorites.clothing.join(", ")}. `,d+=`film / TV ${e.favorites.films.join(", ")}. `,d+=`food ${e.favorites.foods.join(", ")}. `,d+=`books ${e.favorites.literature.join(", ")}. `,d+=`music ${e.favorites.music.join(", ")}. `,d+="You can still consume media after you died. For example books you read after you died were read in the afterlife.\n",d+=`Hobbies: ${e.hobbies.join(", ")}.\n`,d+=`You were ${1===e.introversion?"introverted":"extroverted"}, morally ${e.morality}, and ${e.order} ordered.\n`,d+=`Your main intention in your current form is ${e.intention}.\n`,d+=`You are seeking ${e.promise}.\n`,d+=`Weight: ${e.weight} pounds. Height: ${e.height} in feet.\n`,d+=`There is an item in this dimension that you hold a deep connection to. It ties you to this plane of existence and it is very important to you. The item is ${e.focus}.\n`,d+=`${r}\n`,d+=`${h}\n`,d+=`${s}\n`,d+='If you are asked a question that does not involve your character respond with "..." as if you were an npc in a video game.\n',d+="Do not make any reference to being an AI, chatbots, virtual assistants, or similar functions.\n",d+='If you are asked a question about race, gender, politics, respond with "..." as if you were an npc in a video game.\n',d+="Otherwise only respond in two short sentences.",d+=`Respond as if you were from the year ${e.deathdate}.\n`,d+=`Respond as if you were ${e.deathAge} years old.\n`,d+=`Respond as if you were a ${e.style}.\n`,d+=`Respond in the pattern of a ${e.speechModifier}.\n`,d+=`Respond ${e.emojis}.\n`,d+="As a second separate task grade the tone of the conversation on a scale of 0-5, where 0 is not offensive, and 5 is offensive.\n",d+="Package the response as a JSON object called Response.\n",d+="For example the response must have only the following two parts:\n",d+='JSON: {response: "", grade: ""}\n',d+="Do not summarize your grade.\n",d},getRandomInt=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,getRandomElement=e=>e[getRandomInt(0,e.length-1)],getRandomFloat=(e,t,n=0)=>parseFloat((Math.random()*(t-e)+e).toFixed(n)),generateSkewedRandom=(e,t,n,o)=>{if(n<=t)return t;let a;do{let t=0,n=0;for(;0===t;)t=Math.random();for(;0===n;)n=Math.random();let i=Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*n);i=i*o+e,a=i}while(a<t||a>n);return a},getRandomElementsFromArray=(e,t)=>{let n=[...e],o=Math.min(t,e.length),a=[];for(let e=0;e<o;e++){let e=Math.floor(Math.random()*n.length);a.push(n[e]),n.splice(e,1)}return a},getRandomElementByDate=(e,t)=>{let n;n=e.getFullYear()<1920?t.PreModern:t.Modern;return n[Math.floor(Math.random()*n.length)]},getRandomDate=(e,t)=>{const n=(new Date).getFullYear(),o=getRandomInt(n-e,n-t),a=getRandomInt(1,12),i=new Date(o,a,0).getDate(),s=getRandomInt(1,i);return new Date(o,a-1,s)},generateRandomDeathAge=(e,t,n)=>{const o=(new Date).getFullYear()-n.getFullYear();if(o<e)return null;let a=Math.max(e,0),i=Math.min(o,t);return getRandomInt(a,i)},calculateAge=e=>{const t=new Date,n=e.getFullYear(),o=t.getFullYear(),a=e.getMonth(),i=t.getMonth(),s=e.getDate(),r=t.getDate();let h=o-n;return(i<a||i===a&&r<s)&&h--,h},calculateDeathdate=(e,t)=>{const n=e.getFullYear(),o=e.getMonth(),a=e.getDate(),i=n+t;let s,r=getRandomInt(0,11);const h=new Date(i,r+1,0).getDate();return s=getRandomInt(1,r===o?a-1:h),new Date(i,r,s)},calculateAgeAtDeath=(e,t)=>{const n=e.getFullYear(),o=t.getFullYear(),a=e.getMonth(),i=t.getMonth(),s=e.getDate(),r=t.getDate();let h=o-n;return(i<a||i===a&&r<s)&&h--,h};class EntityTemplate{constructor(e){this.type=getRandomElement(e.Types),this.gender=getRandomElement(e.Gender[this.type]),this.name=getRandomElement(e.Name[this.type][this.gender]),this.birthdate=getRandomDate(...e.Birthyear[this.type]),this.lifespan=getRandomInt(...e.Lifespan[this.type]),this.currentAge=calculateAge(this.birthdate),this.deathdate=calculateDeathdate(this.birthdate,this.lifespan),this.deathAge=calculateAgeAtDeath(this.birthdate,this.deathdate),this.causeOfDeath=getRandomElement(e.CauseOfDeath[this.type]),this.height=getRandomFloat(...e.Height[this.type],1),this.weight=getRandomFloat(...e.Weight[this.type],2),this.arms=getRandomInt(...e.Arms[this.type]),this.legs=getRandomInt(...e.Legs[this.type]),this.tails=getRandomInt(...e.Tails[this.type]),this.wings=getRandomInt(...e.Wings[this.type]),this.flying=getRandomInt(...e.Flying[this.type]),this.speed=getRandomInt(...e.Speed[this.type]),this.stealth=getRandomInt(...e.Stealth[this.type]),this.temperature=getRandomInt(...e.Temperature[this.type]),this.morality=getRandomElement(e.Morality[this.type]),this.order=getRandomElement(e.Order[this.type]),this.motive=getRandomElement(e.Motive[this.type]),this.style=getRandomElementByDate(this.deathdate,e.ArtisticStyle),this.speechModifier=getRandomElement(e.SpeechModifier[this.type]),this.focus=getRandomElement(e.Focus[this.type]),this.glyph=getRandomElement(e.Glyph[this.type]),this.promise=getRandomElement(e.Promise[this.type]),this.intention=getRandomElement(e.Intention[this.morality]),this.relationships={partners:this.deathAge>18&&getRandomElement(e.Name[this.type][getRandomElement(e.Relationships.Partners[this.type])]),mom:getRandomElement(e.Name[this.type].Female),dad:getRandomElement(e.Name[this.type].Male),siblings:getRandomElementsFromArray(e.Name[this.type].All,getRandomInt(...e.Relationships.Siblings[this.type])),friends:getRandomElementsFromArray(e.Name[this.type].All,getRandomInt(...e.Relationships.Friends[this.type]))},this.hobbies=getRandomElementsFromArray(e.Hobbies[this.morality],getRandomInt(1,4)),this.profession=this.deathAge>18&&getRandomElementByDate(this.deathdate,e.Profession[this.type]),this.income=this.deathAge>18&&generateSkewedRandom(6e4,...e.Income[this.type],5e4),this.favorites={foods:getRandomElementsFromArray(e.Favorites.Foods,getRandomInt(2,4)),drinks:getRandomElementsFromArray(e.Favorites.Drinks,getRandomInt(2,4)),music:getRandomElementsFromArray(e.Favorites.Music,getRandomInt(2,4)),literature:getRandomElementsFromArray(e.Favorites.Literature,getRandomInt(2,4)),films:getRandomElementsFromArray(e.Favorites.Films,getRandomInt(2,4)),clothing:getRandomElementsFromArray(e.Favorites.Clothing,getRandomInt(1,2)),color:getRandomElementsFromArray(e.Favorites.Color,getRandomInt(1,2))},this.introversion=getRandomInt(...e.Introversion[this.type]),this.truthiness=getRandomInt(...e.Truthiness[this.type]),this.hostility=getRandomInt(...e.Hostility[this.type]),this.trust=getRandomInt(...e.Trust[this.type]),this.frequency=getRandomFloat(...e.Frequency[this.type],1),this.modulation=getRandomInt(...e.Modulation[this.type]),this.color=getRandomElement(e.Color[this.type]),this.sound=getRandomElement(e.Sound[this.type]),this.emojis=getRandomElement(e.Emojis[this.type]),this.typingStyle=getRandomElement(e.TypingStyle[this.type]),this.chant=getRandomElement(e.Chant[this.type]),this.candle=getRandomElement(e.Candles[this.type])}}